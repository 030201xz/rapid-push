# 热更新工作流 - 验证更新

## 检查更新可用性

```bash
# 模拟客户端检查更新
curl -X GET "http://192.168.8.114:6688/manifests/prod_demo_app_channel_key_12345678" \
  -H "expo-protocol-version: 1" \
  -H "expo-platform: android" \
  -H "expo-runtime-version: 1.0.0" \
  -H "accept: application/expo+json" \
  -i
```

## 请求头说明

### 必需头部(符合 Expo Updates Protocol)
- **expo-protocol-version**: 协议版本(固定为 `1`)
- **expo-platform**: 平台类型(`ios` 或 `android`)
- **expo-runtime-version**: 运行时版本(与 app.json 一致)
- **accept**: 响应格式(`application/expo+json`)

### 可选头部
- **expo-current-update-id**: 当前更新 ID
- **expo-embedded-update-id**: 内置更新 ID

## 成功响应

### 状态码
- `200 OK`: 有更新可用
- `204 No Content`: 无更新

### 响应头
```
HTTP/1.1 200 OK
Content-Type: application/expo+json
expo-protocol-version: 1
expo-sfv-version: 0
Cache-Control: private, max-age=0
```

### Manifest 内容
```json
{
  "id": "1412d967-ac74-40cc-8df0-c60de7c1ee24",
  "createdAt": "2025-12-19T15:42:32.204Z",
  "runtimeVersion": "1.0.0",
  "launchAsset": {
    "hash": "NI5FTJo8QXzS2k_g7Oj_GILNXelQG7Ev0STufhE58R4",
    "key": "_expo/static/js/android/entry-xxx.hbc",
    "contentType": "application/octet-stream",
    "fileExtension": ".hbc",
    "url": "/assets/NI5FTJo8QXzS2k_g7Oj_GILNXelQG7Ev0STufhE58R4"
  },
  "assets": [...],
  "metadata": {
    "version": "1.0.0",
    "timestamp": "1766158951",
    "buildNumber": "2"
  },
  "extra": {}
}
```

## 验证要点

1. ✅ 状态码为 200
2. ✅ Manifest ID 与上传的 Update ID 一致
3. ✅ runtimeVersion 正确
4. ✅ launchAsset 存在
5. ✅ assets 数组不为空(通常 20-30 个资源)
6. ✅ metadata 包含版本信息
