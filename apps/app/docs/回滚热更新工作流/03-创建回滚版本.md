# çƒ­æ›´æ–°å›æ»šå·¥ä½œæµ - åˆ›å»ºå›æ»šç‰ˆæœ¬(ç­–ç•¥äºŒ)

## é€‚ç”¨åœºæ™¯

- ğŸ¯ éœ€è¦å›æ»šåˆ°**ä»»æ„å†å²ç‰ˆæœ¬**(ä¸åªæ˜¯ä¸Šä¸€ä¸ª)
- ğŸ“ éœ€è¦**æ˜ç¡®è®°å½•**å›æ»šæ“ä½œ
- ğŸ”„ å¸Œæœ›**ä¿ç•™é—®é¢˜ç‰ˆæœ¬**ç”¨äºåˆ†æ
- ğŸ“Š è¿è¥éœ€è¦**è¿½è¸ªå›æ»šå†å²**

## å·¥ä½œåŸç†

åˆ›å»ºå›æ»šç‰ˆæœ¬ä¼š:
1. åŸºäºæŒ‡å®šçš„å†å²ç‰ˆæœ¬åˆ›å»ºä¸€ä¸ª**æ–°çš„æ›´æ–°è®°å½•**
2. æ ‡è®° `isRollback = true`
3. è‡ªåŠ¨å¤åˆ¶æºç‰ˆæœ¬çš„æ‰€æœ‰èµ„æº
4. è‡ªåŠ¨å¯ç”¨(isEnabled = true)
5. æˆä¸º**æœ€æ–°ç‰ˆæœ¬**

### ç¤ºä¾‹åœºæ™¯

å‡è®¾å½“å‰æœ‰ä»¥ä¸‹æ›´æ–°:

| åˆ›å»ºæ—¶é—´ | ç‰ˆæœ¬ | å¯ç”¨ | å›æ»š | æè¿° |
|----------|------|------|------|------|
| 16:00 | v1.0.3 | âœ… | âŒ | æœ‰ä¸¥é‡Bug |
| 15:00 | v1.0.2 | âœ… | âŒ | æœ‰æ€§èƒ½é—®é¢˜ |
| 14:00 | v1.0.1 | âœ… | âŒ | æœ‰å°é—®é¢˜ |
| 13:00 | v1.0.0 | âœ… | âŒ | **ç¨³å®šç‰ˆæœ¬** |

åˆ›å»ºå›æ»šåˆ° v1.0.0 å:

| åˆ›å»ºæ—¶é—´ | ç‰ˆæœ¬ | å¯ç”¨ | å›æ»š | æè¿° |
|----------|------|------|------|------|
| **16:10** | **å›æ»š** | **âœ…** | **âœ…** | **å›æ»šè‡³: v1.0.0** â† **ç”Ÿæ•ˆ** |
| 16:00 | v1.0.3 | âœ… | âŒ | æœ‰ä¸¥é‡Bug |
| 15:00 | v1.0.2 | âœ… | âŒ | æœ‰æ€§èƒ½é—®é¢˜ |
| 14:00 | v1.0.1 | âœ… | âŒ | æœ‰å°é—®é¢˜ |
| 13:00 | v1.0.0 | âœ… | âŒ | ç¨³å®šç‰ˆæœ¬(æº) |

## æ“ä½œæ­¥éª¤

### 1. æ‰¾åˆ°ç¨³å®šçš„å†å²ç‰ˆæœ¬

å‚è€ƒ [01-æŸ¥çœ‹æ›´æ–°åˆ—è¡¨.md](01-æŸ¥çœ‹æ›´æ–°åˆ—è¡¨.md) æ‰¾åˆ°è¦å›æ»šåˆ°çš„ç‰ˆæœ¬ã€‚

\`\`\`bash
# æŸ¥çœ‹æ‰€æœ‰æ›´æ–°,æ‰¾åˆ°ç¨³å®šç‰ˆæœ¬
curl -s "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.listByChannel?input=$(echo '{"channelId":"a1b2c3d4-e5f6-4a7b-8c9d-800000000001"}' | jq -sRr @uri)" \
  -H "Authorization: Bearer $ACCESS_TOKEN" | jq -r '.result.data[] | "\(.id[0:8])... | \(.createdAt) | \(.description)"'
\`\`\`

**è¾“å‡ºç¤ºä¾‹**:
\`\`\`
0c70dfc3... | 2025-12-19T16:09:43.564Z | å›æ»šè‡³: æµ‹è¯•æ›´æ–° v1.0.0
9d46c64d... | 2025-12-19T15:58:08.928Z | æµ‹è¯•æ›´æ–° v1.0.1 - ä¿®å¤èµ„æºURL
6c907a9f... | 2025-12-19T15:56:37.005Z | æµ‹è¯•æ›´æ–° v1.0.1 - ä¿®å¤èµ„æºURL
1412d967... | 2025-12-19T15:42:32.204Z | æµ‹è¯•æ›´æ–° v1.0.0  â† é€‰æ‹©è¿™ä¸ª!
\`\`\`

### 2. åˆ›å»ºå›æ»šç‰ˆæœ¬

\`\`\`bash
# è®¾ç½®æºæ›´æ–° ID (è¦å›æ»šåˆ°çš„ç‰ˆæœ¬)
SOURCE_UPDATE_ID="1412d967-ac74-40cc-8df0-c60de7c1ee24"

# åˆ›å»ºå›æ»šç‰ˆæœ¬
curl -s -X POST "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.rollback" \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"sourceUpdateId\":\"$SOURCE_UPDATE_ID\"}" | jq '.result.data | {id, description, isRollback, isEnabled, createdAt}'
\`\`\`

**æˆåŠŸå“åº”**:
\`\`\`json
{
  "id": "0c70dfc3-27a8-432c-ab35-7aea674b6035",
  "description": "å›æ»šè‡³: æµ‹è¯•æ›´æ–° v1.0.0 - 2025-12-19_23:42:31",
  "isRollback": true,
  "isEnabled": true,
  "createdAt": "2025-12-19T16:09:43.564Z"
}
\`\`\`

âœ… æ³¨æ„:
- `isRollback: true` - æ˜ç¡®æ ‡è®°ä¸ºå›æ»šç‰ˆæœ¬
- `description` è‡ªåŠ¨ç”Ÿæˆ,åŒ…å«æºç‰ˆæœ¬ä¿¡æ¯
- `createdAt` æ˜¯å½“å‰æ—¶é—´,ä½œä¸ºæœ€æ–°ç‰ˆæœ¬

### 3. éªŒè¯å›æ»šç”Ÿæ•ˆ

ç«‹å³éªŒè¯å®¢æˆ·ç«¯æ”¶åˆ°çš„æ˜¯å›æ»šç‰ˆæœ¬:

\`\`\`bash
curl -s "http://192.168.8.114:6688/manifests/prod_demo_app_channel_key_12345678" \
  -H "expo-protocol-version: 1" \
  -H "expo-platform: android" \
  -H "expo-runtime-version: 1.0.0" \
  -H "expo-api-version: 1" \
  -H "expo-expect-signature: 1" | jq '{id, createdAt, metadata}'
\`\`\`

**è¾“å‡ºç¤ºä¾‹** (åº”è¯¥è¿”å›åˆšåˆ›å»ºçš„å›æ»šç‰ˆæœ¬):
\`\`\`json
{
  "id": "0c70dfc3-27a8-432c-ab35-7aea674b6035",
  "createdAt": "2025-12-19T16:09:43.564Z",
  "metadata": {
    "version": "1.0.0",
    "timestamp": "1766158951",
    "buildNumber": "2"
  }
}
\`\`\`

âœ… ID åŒ¹é…,è¯´æ˜å›æ»šç‰ˆæœ¬å·²ç”Ÿæ•ˆ!

## å›æ»šç‰ˆæœ¬çš„ç‰¹ç‚¹

### è‡ªåŠ¨å¤åˆ¶èµ„æº

å›æ»šç‰ˆæœ¬ä¼š**è‡ªåŠ¨å¤åˆ¶**æºç‰ˆæœ¬çš„æ‰€æœ‰èµ„æº,åŒ…æ‹¬:
- å¯åŠ¨èµ„æº (launch asset)
- æ‰€æœ‰ä¾èµ–èµ„æº (assets)
- èµ„æºå…³è”å…³ç³» (update_assets)

è¿™æ„å‘³ç€å›æ»šç‰ˆæœ¬æ˜¯**å®Œæ•´å¯ç”¨çš„**,ä¸éœ€è¦é¢å¤–æ“ä½œã€‚

### å…ƒæ•°æ®ç»§æ‰¿

å›æ»šç‰ˆæœ¬ç»§æ‰¿æºç‰ˆæœ¬çš„:
- `runtimeVersion`
- `metadata`
- `extra`

ä½†**ä¸ç»§æ‰¿**:
- `downloadCount` - é‡ç½®ä¸º 0
- `installCount` - é‡ç½®ä¸º 0
- `rolloutPercentage` - é»˜è®¤ 100%

### æè¿°è‡ªåŠ¨ç”Ÿæˆ

æè¿°æ ¼å¼ä¸º: `å›æ»šè‡³: {æºç‰ˆæœ¬æè¿°}`

å¦‚æœæºç‰ˆæœ¬æ²¡æœ‰æè¿°,åˆ™ä½¿ç”¨: `å›æ»šè‡³: {æºç‰ˆæœ¬ID}`

## å®Œæ•´ç¤ºä¾‹

### ä¸€é”®åˆ›å»ºå›æ»šå¹¶éªŒè¯

\`\`\`bash
#!/bin/bash

# è®¾ç½®å˜é‡
CHANNEL_ID="a1b2c3d4-e5f6-4a7b-8c9d-800000000001"
CHANNEL_KEY="prod_demo_app_channel_key_12345678"
RUNTIME_VERSION="1.0.0"

# 1. æŸ¥çœ‹æ‰€æœ‰æ›´æ–°
echo "ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰æ›´æ–°..."
curl -s "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.listByChannel?input=$(echo "{\"channelId\":\"$CHANNEL_ID\"}" | jq -sRr @uri)" \
  -H "Authorization: Bearer $ACCESS_TOKEN" | jq -r '.result.data[] | "\(.id[0:8])... | \(.description)"'

echo ""
echo "è¯·è¾“å…¥è¦å›æ»šåˆ°çš„ç‰ˆæœ¬ ID:"
read SOURCE_UPDATE_ID

# 2. åˆ›å»ºå›æ»šç‰ˆæœ¬
echo ""
echo "ğŸ”„ åˆ›å»ºå›æ»šç‰ˆæœ¬..."
ROLLBACK=$(curl -s -X POST "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.rollback" \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"sourceUpdateId\":\"$SOURCE_UPDATE_ID\"}")

ROLLBACK_ID=$(echo $ROLLBACK | jq -r '.result.data.id')
ROLLBACK_DESC=$(echo $ROLLBACK | jq -r '.result.data.description')

echo "   ID: $ROLLBACK_ID"
echo "   æè¿°: $ROLLBACK_DESC"
echo ""

# 3. éªŒè¯å›æ»š
echo "âœ… éªŒè¯å›æ»š..."
CURRENT=$(curl -s "http://192.168.8.114:6688/manifests/$CHANNEL_KEY" \
  -H "expo-protocol-version: 1" \
  -H "expo-platform: android" \
  -H "expo-runtime-version: $RUNTIME_VERSION" \
  -H "expo-api-version: 1" \
  -H "expo-expect-signature: 1" | jq '{id, createdAt}')

echo "   å½“å‰ç”Ÿæ•ˆç‰ˆæœ¬:"
echo $CURRENT | jq '.'
echo ""

# 4. æ£€æŸ¥æ˜¯å¦æˆåŠŸ
CURRENT_ID=$(echo $CURRENT | jq -r '.id')
if [ "$CURRENT_ID" == "$ROLLBACK_ID" ]; then
  echo "âœ… å›æ»šæˆåŠŸ! å›æ»šç‰ˆæœ¬å·²ç”Ÿæ•ˆ"
else
  echo "âŒ å›æ»šå¤±è´¥! å½“å‰ç‰ˆæœ¬: $CURRENT_ID"
fi
\`\`\`

## å›æ»šåæ“ä½œ

### 1. è®°å½•å›æ»šäº‹ä»¶

\`\`\`
ğŸ“ å›æ»šè®°å½•

- å›æ»šæ—¶é—´: 2025-12-19 16:10:00
- æ“ä½œäºº: @admin
- å›æ»šåŸå› : v1.0.3 å­˜åœ¨ä¸¥é‡å´©æºƒé—®é¢˜
- æºç‰ˆæœ¬: v1.0.0 (1412d967...)
- å›æ»šç‰ˆæœ¬: 0c70dfc3...
- å½±å“èŒƒå›´: æ‰€æœ‰ç”¨æˆ·
- é¢„æœŸæ•ˆæœ: å´©æºƒç‡é™ä½åˆ° < 1%

é™„åŠ è¯´æ˜:
- é—®é¢˜ç‰ˆæœ¬å·²ä¿ç•™ç”¨äºåˆ†æ
- å¼€å‘å›¢é˜Ÿæ­£åœ¨ä¿®å¤é—®é¢˜
- é¢„è®¡ 24 å°æ—¶å†…å‘å¸ƒä¿®å¤ç‰ˆæœ¬
\`\`\`

### 2. ç¦ç”¨é—®é¢˜ç‰ˆæœ¬

è™½ç„¶å›æ»šç‰ˆæœ¬å·²ç»æ˜¯æœ€æ–°çš„,ä½†å»ºè®®ç¦ç”¨é—®é¢˜ç‰ˆæœ¬é¿å…æ··ä¹±:

\`\`\`bash
PROBLEM_UPDATE_ID="9d46c64d-1b34-42c9-b65b-e472b4cbdaf0"

curl -s -X POST "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.updateSettings" \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"id\":\"$PROBLEM_UPDATE_ID\",\"isEnabled\":false}"
\`\`\`

### 3. é€šçŸ¥ç›¸å…³äººå‘˜

\`\`\`
ğŸš¨ ç´§æ€¥å›æ»šé€šçŸ¥

ç³»ç»Ÿå·²æ‰§è¡Œå›æ»šæ“ä½œ:
- ä»: v1.0.3 (å´©æºƒç‡ 15%)
- åˆ°: v1.0.0 (ç¨³å®šç‰ˆæœ¬)
- æ–¹å¼: åˆ›å»ºå›æ»šç‰ˆæœ¬

ç°çŠ¶:
- âœ… å›æ»šç‰ˆæœ¬å·²ç”Ÿæ•ˆ
- âœ… é—®é¢˜ç‰ˆæœ¬å·²ç¦ç”¨
- â° ç”¨æˆ·å°†åœ¨ä¸‹æ¬¡æ‰“å¼€ App æ—¶æ›´æ–°

åç»­:
- [ ] ç›‘æ§å›æ»šæ•ˆæœ
- [ ] åˆ†æé—®é¢˜åŸå› 
- [ ] å‡†å¤‡ä¿®å¤ç‰ˆæœ¬
\`\`\`

## ç®¡ç†å›æ»šç‰ˆæœ¬

### æŸ¥çœ‹æ‰€æœ‰å›æ»šç‰ˆæœ¬

\`\`\`bash
curl -s "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.listByChannel?input=$(echo '{"channelId":"a1b2c3d4-e5f6-4a7b-8c9d-800000000001"}' | jq -sRr @uri)" \
  -H "Authorization: Bearer $ACCESS_TOKEN" | jq -r '.result.data[] | select(.isRollback == true) | "\(.id[0:8])... | \(.description) | \(.createdAt)"'
\`\`\`

### ç¦ç”¨å›æ»šç‰ˆæœ¬

å¦‚æœè¦æ¢å¤åˆ°é—®é¢˜ç‰ˆæœ¬(æ¯”å¦‚é—®é¢˜å·²ä¿®å¤):

\`\`\`bash
ROLLBACK_ID="0c70dfc3-27a8-432c-ab35-7aea674b6035"

curl -s -X POST "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.updateSettings" \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"id\":\"$ROLLBACK_ID\",\"isEnabled\":false}"
\`\`\`

### åˆ é™¤å›æ»šç‰ˆæœ¬

å¦‚æœå›æ»šç‰ˆæœ¬ä¸å†éœ€è¦:

\`\`\`bash
ROLLBACK_ID="0c70dfc3-27a8-432c-ab35-7aea674b6035"

curl -s -X POST "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.delete" \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"id\":\"$ROLLBACK_ID\"}"
\`\`\`

## å¸¸è§é—®é¢˜

### Q: å›æ»šç‰ˆæœ¬ä¼šè¦†ç›–æºç‰ˆæœ¬å—?

A: **ä¸ä¼š**ã€‚æºç‰ˆæœ¬ä¿æŒä¸å˜,å›æ»šç‰ˆæœ¬æ˜¯**æ–°åˆ›å»º**çš„è®°å½•ã€‚

### Q: å¯ä»¥åŸºäºå›æ»šç‰ˆæœ¬å†æ¬¡å›æ»šå—?

A: **å¯ä»¥**ã€‚å›æ»šç‰ˆæœ¬æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ›´æ–°,å¯ä»¥ä½œä¸ºæºç‰ˆæœ¬ã€‚

### Q: å›æ»šç‰ˆæœ¬çš„èµ„æºä¼šå ç”¨é¢å¤–å­˜å‚¨å—?

A: **ä¸ä¼š**ã€‚èµ„æºæ˜¯é€šè¿‡å¼•ç”¨å…±äº«çš„,ä¸ä¼šé‡å¤å­˜å‚¨ã€‚

### Q: åˆ›å»ºå›æ»šç‰ˆæœ¬éœ€è¦å¤šä¹…?

A: é€šå¸¸ **< 1 ç§’**ã€‚åªæ˜¯åˆ›å»ºè®°å½•å’Œå…³è”,ä¸éœ€è¦é‡æ–°ä¸Šä¼ èµ„æºã€‚

### Q: å¯ä»¥è‡ªå®šä¹‰å›æ»šç‰ˆæœ¬çš„æè¿°å—?

A: ç›®å‰**ä¸æ”¯æŒ**ã€‚æè¿°è‡ªåŠ¨ç”Ÿæˆã€‚å¦‚éœ€ä¿®æ”¹:

\`\`\`bash
curl -s -X POST "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.updateSettings" \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"id\":\"$ROLLBACK_ID\",\"description\":\"ç´§æ€¥å›æ»š: ä¿®å¤å´©æºƒé—®é¢˜\"}"
\`\`\`

### Q: å›æ»šç‰ˆæœ¬å¯ä»¥ç°åº¦å‘å¸ƒå—?

A: **å¯ä»¥**ã€‚åˆ›å»ºåä¿®æ”¹ rolloutPercentage:

\`\`\`bash
curl -s -X POST "http://192.168.8.114:6688/trpc/hotUpdate.manage.updates.updateSettings" \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"id\":\"$ROLLBACK_ID\",\"rolloutPercentage\":50}"
\`\`\`

## ä¼˜ç¼ºç‚¹æ€»ç»“

### âœ… ä¼˜ç‚¹

- å¯ä»¥å›æ»šåˆ°ä»»æ„å†å²ç‰ˆæœ¬
- å›æ»šå†å²æ¸…æ™°å¯è¿½è¸ª
- æ˜ç¡®æ ‡è®°(isRollback = true)
- ä¸å½±å“æºç‰ˆæœ¬
- æ”¯æŒæ‰€æœ‰æ›´æ–°åŠŸèƒ½(ç°åº¦ã€ç¦ç”¨ç­‰)

### âš ï¸ æ³¨æ„äº‹é¡¹

- ä¼šåˆ›å»ºæ–°çš„æ•°æ®åº“è®°å½•
- ç¨å¾®æ…¢äºç­–ç•¥ä¸€(ä½†ä»ç„¶å¾ˆå¿«)
- éœ€è¦æ‰‹åŠ¨ç¦ç”¨é—®é¢˜ç‰ˆæœ¬(å¯é€‰)

## å¯¹æ¯”ç­–ç•¥ä¸€

| ç‰¹æ€§ | ç­–ç•¥ä¸€(ç¦ç”¨) | ç­–ç•¥äºŒ(å›æ»šç‰ˆæœ¬) |
|------|-------------|-----------------|
| é€Ÿåº¦ | âš¡âš¡âš¡ æå¿« | âš¡âš¡ å¿« |
| å›æ»šèŒƒå›´ | ä»…ä¸Šä¸€ä¸ªç‰ˆæœ¬ | ä»»æ„ç‰ˆæœ¬ |
| è®°å½•è¿½è¸ª | âŒ ä¸æ˜æ˜¾ | âœ… æ¸…æ™° |
| æ“ä½œå¤æ‚åº¦ | ç®€å• | ç¨å¤æ‚ |
| æ¨èåœºæ™¯ | ç´§æ€¥å›æ»š | è·¨ç‰ˆæœ¬å›æ»š |

## æœ€ä½³å®è·µ

1. **é€‰æ‹©ç¨³å®šç‰ˆæœ¬** - ç¡®è®¤æºç‰ˆæœ¬ç¡®å®ç¨³å®š
2. **ä¿ç•™é—®é¢˜ç‰ˆæœ¬** - ä¸è¦åˆ é™¤,ç”¨äºåˆ†æ
3. **è®°å½•æ“ä½œ** - æ–‡æ¡£åŒ–å›æ»šåŸå› å’Œè¿‡ç¨‹
4. **ç›‘æ§æ•ˆæœ** - å›æ»šåæŒç»­ç›‘æ§
5. **åŠæ—¶é€šçŸ¥** - é€šçŸ¥å›¢é˜Ÿå’Œç”¨æˆ·(å¦‚éœ€è¦)

## ä¸‹ä¸€æ­¥

å›æ»šåè¯·æ‰§è¡Œ: [04-éªŒè¯å›æ»š.md](04-éªŒè¯å›æ»š.md)
